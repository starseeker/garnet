;; $Id$

;;;; aggregadgets.lisp
#|
======================================================================
Change log:
  05 Jan 94 amickish  Set-values ---> s-value
  15 Jun 93 amickish  In Get-Part-From-Function, don't set up :known-as if the
                      part-name is a number
  10 Jun 93 amickish  Moved definition of safe-functionp to garnet-utils
  20 May 93 amickish  Had to declare name slot of agget constant in Call-C-I
  19 May 93 amickish  Called add-component/interactor inside Call-Create-Inst
                      so that Create-Part and Create-Inter do not have to
                      add extra slot/value pairs to the slots list.
   7 Apr 93 amickish  Declared part-name constant in agget in Get-Part-From-Fn
  26 Mar 93 amickish  Removed EVAL from Call-Create-Instance for the last time!
  25 Mar 93 dzg  Added DECLARE-CONSTANT's in Get-Part-From-Function
  26 Feb 93 amickish  Rewrote Call-Create-Instance to use begin/end-create-
                      instance and not use copy-tree (ick).
   3 Jun 92 amickish  Wrote Get-Part-From-Function which allows a single part
                      to be generated by a function
  30 Apr 92 amickish  Bound kr::*redefine-ok* in Create-Part
  28 Apr 92 amickish  Wrapped destroy-slot calls in with-constants-disabled
   8 Apr 92 amickish  Made Call-Create-Instance non-destructive
   7 Apr 92 amickish  Wrapped calls to Call-Create-Instance in
                      with-constants-disabled.
  26 Mar 92 amickish  Get-Values--->G-Value; Get-Local-Values--->G-Local-Value
  16 Mar 92 amickish  Removed append-constant-slots -- obviated by KR.
  10 Mar 92 amickish  Fixed Call-Create-Instance to handle multiple-values
  03 Mar 92 amickish  Fixed Inherit-Values to use *inherit-formula*; broke
                      Get-Inherited-Value off from Inherit-Values
  28 Feb 92 amickish  Quoted class parameter in Call-Create-Instance
  24 Feb 92 amickish  Declared :components constant in :initialize method
  18 Feb 92 amickish  Implemented :constant slot functionality
  28 Jan 92 amickish  Rewrote create-part and create-inter to use
                  create-instance.  Changed name of first-obj-in-parts-list
                  to is-first-comp-in-parts-list.
  15 Apr 91 bam   Added the :behaviors slot to the :local-only-slots of
                  aggregadget
  16 Jul 90 rbd   Changed compilation order: aggregadgets first
   8 May 90 rbd   Major changes for new version.
   11/28/89 ecp   Fixed bug in create-part such that aggrelists were not
                  getting initialized correctly.
    9/28/89 ecp   Aggrelists can now have :interactors slots, too.
    9/18/89 ecp   Copy-parts should not have been calling itself recursively.
    9/14/89 ecp   The :initialize method for aggregadgets has optional
                  second argument to keep track of top level.
    8/2/89  prm   Optimized code after review meeting.
    7/20/89 prm   Removed aggregitems (now integrated to aggrelists).
    7/13/89 prm   Changed to work with aggrelists.
    7/6/89  prm   Changed syntax (class names must be comma-ed) to keep
                  everything consistent.
    6/28/89 prm   Changed to accept open formulas. This involved a change
                  of syntax (:parts and :interactors are now lists)
    6/28/89 prm   Changed the syntax: now :parts and :interactors are
                  lists instead of multi-value slots.
    6/28/89 prm   Fixed a bug: now sets :behaviors properly
    6/23/89 prm   Quoted the names in calls to create-instance, in order
                  to match KR 2.2
    6/8/89  prm   Added "element style" components (aggregitems)
    6/5/89  prm   Fixed a bug: now when copying a part that is an
                  aggregadget, create-prototype is called instead
                  of create-instance
    5/15/89 prm   Optimized the creation of instances of aggregadget
                  prototypes (makes copies of the prototype).
    5/11/89 prm   call-prototype-method moved to the beginning
                  of the :initialize method.
    4/18/89 prm   Changed again to match KR v2.0 (methods)
    4/07/89 prm   Changed to match KR v2.0
    3/28/89 prm   Added built-in interactors.
======================================================================
|#


;;;; aggregadgets-compiler.lisp
;;; Changes:
;;; 10/2/03 RGA --- New compile/load protocol
;;; 7/28/96 RGA --- changed to use garnet-compile/load
;;; 14-May-93 Mickish     Added new files, split off from others
;;; 20-Jan-92 Mickish     Removed make-package call
;;; 26-Mar-91 Pervin      Load compiled files in Lucid.
;;; 22-Mar-91 Pervin      Added setf of :garnet-modules, and provides at end.
;;; 19-Mar-91 Pervin      Added aggregraphs.
;;; 4-Mar-91 D'Souza      Removed nickname "MO" of Opal.
;;; 5-Jun-90 Richardson   Added lispworks
;;; 8-May-90 Dannenberg   Added new files
;;; 16-Apr-90 Pervin      Changed #+explorer to #+(or allegro explorer)
;;; 12-Apr-90 Mitchell    Added #+allegro (gc t)
;;; 3/22/90 Robert Cook - Define the package "OPAL" for the TI Explorer

;;;; save-agg.lisp
#|
======================================================================
Change log:
 9/01/93 amickish - Changed opal:text's :do-not-dump-slots for new design
 8/19/93 amickish - Added light motif colors and filling styles
 7/26/93 amickish - Moved defvar of *standard-element-slots* to copy-agg.lisp
           to avoid compiler warning
 7/02/93 amickish - Changed *standard-element-slots* for new aggrelists
 6/30/93 amickish - Made Write-Slots a method so that multifont-text can
           override its behavior
 6/23/93 bvz - Added slots to interactor's :do-not-dump-slots
 6/22/93 amickish - Removed :rank from *standard-element-slots*
 6/15/93 amickish - Changed :old-items to be a copy-but-don't-dump slot
 5/28/93 dzg - replaced called to obsolete kr::iterate-accessor with call to
	   kr::iterate-slot-value.
 5/24/93 amickish - Fixed output-name for interactors (bug introduced 11/9/92)
 5/20/93 amickish - Removed :internally-parented and :line-break-p references
 5/14/93 amickish - Removed references to *each-left/top-form*
 4/23/93 amickish - Added :old-items to *standard-element-slots*; added
           MOTIF-MENUBAR, MOTIF-RECT, MOTIF-TRILL-DEVICE, and POPUP-MENU-BUTTON
           to *standard-names*
 3/25/93 dzg - Fixed OUTPUT-META-IF-NEEDED to save initial value
 1/18/93 dzg - Added support for dumping formula meta-information.
 1/11/93 amickish - Removed :fast-redraw-p from :do-not-dump-slots
12/30/92 amickish - Write out calls to opal:get-standard-font when appropriate
12/15/92 dzg - Added printing of type declarations
11/09/92 amickish - Added printing of individual aggrelist components when
           :dump-children-as-parts is T.
07/14/92 dzg - Added printing of characters to output-value
07/08/92 amickish - Removed binding of 'state' in output-item-prototype;
           redesigned format procedures in Output-Formula; removed check
           of whether a component was an aggrelist element before deciding
           not to dump slots listed in *standard-element-slots* (now they
           are not dumped for all objects);
06/24/92 amickish - added formula-p checks to existing schema-p checks
05/01/92 bvz - added new stuff to interactors' :do-not-dump-slots list.
04/27/92 dzg - fixed output-formula to print formulas whose value is a list
               properly.
04/20/92 amickish - Added :gg-selected to :do-not-dump-slots of view-object
04/17/92 amickish - Added GARNETDRAW::MOVING-RECT, etc.
04/13/92 Pervin - Added :initial-element nil to all make-arrays.
04/10/92 Pervin - moved definitions of indent, outdent, tab earlier
                  to eliminate warnings, and declared *save-indent* in defvar.
04/07/91 amickish - Get-Local-Value ---> G-Local-Value
03/30/92 dzg - fixed to dump O-FORMULAS properly.
03/25/92 amickish - Get-Values ---> G-Value
03/10/92 Pervin - Write a filling-style as a call to opal:halftone when
           possible.
03/03/92 amickish - added another clause in Write-Slots cond to handle
           :constant lists that contain the :parent slot
03/03/92 amickish - fixed is-an-inherit-formula to be consistent with
           Inherit-Values in aggregadgets.lisp;  added progn in WRITE-SLOTS
           to set variables properly; added :internally-parented to
           :do-not-dump-slots list of opal:view-object
02/19/92 dzg - fixed write-gadget to work with KR 2.0.5.  Slots that used to
	   have a formula and became constant are dumped as values, but not
	   as constant values.
	   E-FORMULA is broken.  Is anybody using it???
01/08/92 Pervin - Really fixed bug I thought I fixed 07/09/91.
12/09/91 Amickish - Converted from multiple- to single-valued slots, and
           changed references to :is-a to break up the returned list.
11/27/91 Amickish - Changed the way that the garnet-gadgets package is created
11/26/91 Pervin - DO write out :image slot of bitmap if it's a formula.
08/30/91 Pervin/VanderZanden - Do not write out :image slot of bitmap.
07/09/91 Edward Pervin - Print out one more ")" when printing :interactors
	   of aggregadget.
04/08/91 Andrew Mickish - Added opal:cursor-text to list of known objects;
           Removed :window, added :final-feed-inuse, :final-feed-avail, and
           :generated-running-where to :do-not-dump-slots of inter:interactor.
03/11/91 Dario Giuse - Changed Output-Formula to fix problem saving bitmaps
11/04/90 Dannenberg :do-not-dump-objects can be used to suppress writing
           children graphic-qualities are now written out using create-instance
======================================================================
|#

;;;; aggrelists.lisp
#|
======================================================================
Change log:
01/14/97 Russell Almond --- Added last item right justified code.
06/13/94 Mickish/Bolt - Referenced :indent slot inside Dimensions-Fn
09/17/93 Andrew Mickish - Set :left and :top of item-prototype in Create-Items
           to prevent inheritance of bogus formulas when IP is an aggregadget
07/09/93 Andrew Mickish - Set :tail of aggrelist when only one component
06/23/93 Andrew Mickish - Added :visible-components slot
05/31/93 Andrew Mickish - New dimensions-fn that takes :rank-margin and
           :pixel-margin into account
05/26/93 Andrew Mickish - Added :layout-fixed? formula
05/20/93 Andrew Mickish - Restored top-level :fixed-width/height formulas;
           Removed :line-break-p references
05/19/93 Andrew Mickish - Removed :internally-parented references; only set
           :item-prototype-object in prototype aggrelist; removed definition
           of opal::destroy-constraints
05/14/93 Mickish/Kosbie - Removed aggrelist maintenance formulas from
           components; now lay out components with :fix-update-slots method;
           fixed Dimensions-Fn for aggrelists with NIL direction;
           removed all references to :prev-visible
03/30/93 Andrew Mickish - Used begin/end-c-i in Generate-Aggrelist-Components
03/24/93 Dario Giuse - Adjusted scoping of with-constants-disabled in
           Generate-Aggrelist-Components
01/18/93 Andrew Mickish - In :initialize method of aggrelist, set :old-items;
           made :items an update-slot for new :fix-update-slots method
12/10/92 Andrew Mickish - Added type declarations
11/06/92 Andrew Mickish - In :initialize method of aggrelist, do not call
           create-items if a :parts list was supplied
 3/18/92 Conrad Poelman - Added :width and :height aggrelist formulas
           that do not depend on the :left and :top of the aggrelist.
 3/10/92 Andrew Mickish - In :initialize method, declared :prev slot constant
           in each component generated from a :parts list
 2/07/92 Andrew Mickish - Converted calls to aggrelist maintenance functions
           (like base-left-fn, etc.) to be formulas.  Rewrote create-items
           to declare constant slots.  Added maybe-constant list.
10/10/91 Andrew Mickish - Fixed remove-local-component to remove the
           component corresponding to the item being removed.
 8/26/91 Pervin/VanDerZanden - In :destroy method for aggrelist, don't
           destroy item-prototype.
 4/22/91 Andrew Mickish - Added :notice-items-changed method for aggrelists
           and changed n-i-c function
 7/13/89 Philippe Marchal - Reviewed, Changed to match KR V2.2
 5/24/89 David Kosbie  - Created
======================================================================
|#


#| add-agg.lisp
======================================================================
Change log:
  07/14/93 Andrew Mickish - Fixed :replace-item-prototype-object method to work
             with new aggrelists;  New Remove-The-Component;
             Eliminated recursive maintenance of components in add-item and
             remove-item, since it will be taken care of by fix-update-slots
  05/28/93 Dario Giuse    - Replaced bindings of kr::*constants-disabled* with
	     calls to with-constants-disabled.
  05/20/93 Andrew Mickish - Removed calls to opal::destroy-constraints
  04/19/93 Andrew Mickish - Fixed Fix-Update-Slots method to handle change in
             :items value from a list to a number and vice versa.
  03/03/93 Andrew Mickish - Fixed Option-Button-String-Func to consider label;
             Aggrelist-Edit-String-Func now calls :new-item-label method
             (used by menubars)
  03/01/93 Andrew Mickish - In add/remove-item methods, check whether items
             is a number, not whether it is a cons (same effect without
             crashing on NIL :items list)
  02/24/93 Andrew Mickish - Added Aggrelist-Edit-String-Func
  02/19/93 Andrew Mickish - Gadget-Add/Remove-Item slot parameter can be a list
             for gadgets with aggrelists not at the top-level (option-button)
  01/18/93 Andrew Mickish - Notice-items-changed --> :fix-update-slots
  12/03/92 Andrew Mickish - Made item parameter optional for :add-item method;
             Fixed :remove-nth-item method to remove nth component; Fixed
             aggrelist methods to work when :items is a number
  06/16/92 Andrew Mickish - New aggrelist and gadget methods (comments below)
  04/13/92 Brad VanderZanden - In :remove-component, do not remove an instance
	     from an aggregadget if in the same aggregadget as the prototype.
  04/07/92 Andrew Mickish - Get-Local-Value ---> G-Local-Value
  03/25/92 Andrew Mickish - Get-Values ---> G-Value
  03/18/92 Andrew Mickish - Added condition to recursion in :remove-item method
  11/06/91 Edward Pervin - Made move-component a method.
  05/13/91 Edward Pervin - Add-item and remove-item had been defined
	     in aggrelists.lisp.
  04/22/91 Andrew Mickish - Added Gadget-Add-Item and Gadget-Remove-Item
======================================================================
|#

;;;; agg-fix-slots.lisp
#|
======================================================================
Change log:
  01/14/97 Russell Almond --- Added last item right justified code.
  09/17/93 Andrew Mickish - Do not declare :left and :top of component constant
             just because it was generated from a :parts list
  08/12/93 Andrew Mickish - Called Fix-Items at top of fix-update-slots method
  07/26/93 Andrew Mickish - Called Set-Rank-Slots at beginning of :f-u-s method
  07/14/93 Andrew Mickish - Made fix-update-slots only work on local aggrelist
  06/22/93 Andrew Mickish - Notice-items-changed invokes fix-update-slots;
             added Set-Rank-Slots
  05/26/93 Andrew Mickish - Referenced :layout-fixed? in :fix-update-slots
  05/20/93 Andrew Mickish - Declare maintenance slots of components constant
             when the aggrelist is layed out for the first time
  05/14/93 Andrew Mickish - Split off from add-agg.lisp and aggrelists.lisp
======================================================================
|#

;;;; agg-labels.lisp
#|
======================================================================
Change log:
  05/14/93 Andrew Mickish - Split off from add-agg.lisp
======================================================================
|#

;;;; aggregraphs.lisp
#|
======================================================================
Change log:
    6/17/04  Robert Goldman - The original version of aggregraphs
             crashed if the aggregraph was initially
             created with no root nodes and nodes were later added.
    6/01/93  Andrew Mickish - Added some macros
    4/15/92  Martin Sjolin - Add #-cmu flags before :rehash-size 2.0
   03/25/92  Andrew Mickish - Get-Values ---> G-Value
   12/13/91  Dario Giuse - Removed (declare (ignore dummy)) from
			:add-node of aggregraph.
   11/27/91  Andrew Mickish - Added args parameter to initialize method
               so that an aggregraph can be a part of an aggregadget
    4/01/91  Bryan Loyall - Added cache for :add-node method to make
               multiple node additions to the same set of parents and
               children faster.
    4/01/91  Bryan Loyall - Changed find-good-y-near-desired-y to
               avoid spaces above the :top of the graph
    3/13/91  Andrew Mickish - Added lines to :add-node that will put the
               new node in the hash table in :source->graph-node-table
    3/12/91  Andrew Mickish - :x-dist-between-nodes ==> :h-spacing,
                              :y-dist-between-nodes ==> :v-spacing
    3/11/91  Andrew Mickish - Merged into Opal/Aggregadgets format
    3/09/91  Bryan Loyall - Created
======================================================================
|#

;;;; copy-agg.lisp
;;; Change log:
;; 07/26/93 Andrew Mickish - Moved defvar of *standard-element-slots* here from
;;                           save-agg.lisp to avoid compiler warning
;; 06/30/93 Andrew Mickish - Added :initialize-copy method
;; 06/25/93 Andrew Mickish - Set slot type of :known-as after s-valuing it.
;; 06/12/93 Andrew Mickish - Set :update-slots-values of aggrelists during
;;                           initialization; Set name slot in aggregadget corres-
;;                           ponding to copied behavior's :known-as.
;; 05/28/93 Dario Giuse    - Eliminated kr::schema-slots, finished conversion to
;; 			     KR 2.3.  Replaced quite a few bindings of
;; 			     kr::*constants-disabled* with calls to the exported
;; 			     macro with-constants-disabled.  Replaced internal
;; 			     stuff to decide whether slot is constant with a
;; 			     call to the exported function slot-constant-p.
;; 			     Added a small amount of test code, at the end of
;; 			     the file, inside a #| |# comment.
;; 05/24/93 David Kosbie   - Added extra arg of NIL to kr::set-slot-accessor to
;;                           run under new KR 2.3.  Also removed link-constants
;;                           argument to process-constant-slots.
;; 05/20/93 Andrew Mickish - Removed :internally-parented references
;; 03/10/93 Andrew Mickish - Wrapped with-constants-disabled around add-component
;;                           of copied components at end of Copy-Slots.
;; 12/10/92 Dario Giuse    - Added copying of type declarations.
;; 11/20/92 Andrew Mickish - At end of Copy-Slots, only set :behaviors if
;;                           behaviors is non-NIL;  only copy the :item-prototype-
;;                           object if the agget has a local :item-prototype
;;                           description
;; 06/22/92 Andrew Mickish - Added parameter to kr::process-constant-slots
;; 04/09/92 Dario Guise    - Changed "ordinary copy" clause of Copy-Slots
;;                           for compatibility with new version of KR
;; 04/01/92 Andrew Mickish - Added parameter to kr::process-constant-slots
;; 03/03/92 Andrew Mickish - Called Get-Inherited-Value instead of Inherit-Value
;; 02/19/92 Dario Giuse    - Modified COPY-SLOTS to keep constant bits from the
;; 			     source schema.  This means that COPY-GADGET preserves
;; 			     constant information.
;; 02/14/92 Dario Giuse    - Removed obsolete check for :DEPENDED-SLOTS.
;; 			     Added some more kr::*constants-disabled* in
;; 			     COPY-SLOTS.
;; 02/14/92 Andrew Mickish - Bound kr::*constants-disabled* in COPY-SLOTS
;; 02/04/92 Andrew Mickish - Added kr::process-constant-slots and new-parent
;;			     parameter to COPY-SLOTS.
;; 01/07/92 Andrew Mickish - Added progn in COPY-SLOTS to set variables properly
;; 12/09/91 Andrew Mickish - Converted from multiple- to single-valued slots
;; 01/17/91 Dario Giuse    - Added a condition to the COND in COPY-SLOTS


;;;; scalable-aggregraph-image.lisp
#|
======================================================================
Change log:
   12/08/92  Andrew Mickish - Removed :x1,:y1,:x2,:y2 slot definitions from
               scalable-aggregraph-image-link-prototype
   11/27/91  Andrew Mickish - Added args parameter to initialize method
               so that an aggregraph can be a part of an aggregadget
    3/11/91  Andrew Mickish - Merged into Opal/Aggregadgets format
    3/09/91  Bryan Loyall - Created
======================================================================
|#


;;;; scalable-aggregraph.lisp
#|
======================================================================
Change log:
    4/15/92  Martin Sjolin - Add #-cmu flags before :rehash-size 2.0
    3/25/92  Andrew Mickish - Get-Values ---> G-Value
    4/01/91  Bryan Loyall - Changed find-good-y-near-desired-y to
               avoid spaces above the :top of the graph
    3/13/91  Andrew Mickish - Added lines to :add-node that will put the
               new node in the hash table in :source->graph-node-table
    3/12/91  Andrew Mickish - :x-dist-between-nodes ==> :h-spacing,
                              :y-dist-between-nodes ==> :v-spacing
    3/7/91  Andrew Mickish - Merged into Opal/Aggregadgets format
    3/1/91  Bryan Loyall - Created
======================================================================
|#

