;; $Id$

;;;; aggregadgets.lisp
#|
======================================================================
Change log:
  05 Jan 94 amickish  Set-values ---> s-value
  15 Jun 93 amickish  In Get-Part-From-Function, don't set up :known-as if the
                      part-name is a number
  10 Jun 93 amickish  Moved definition of safe-functionp to garnet-utils
  20 May 93 amickish  Had to declare name slot of agget constant in Call-C-I
  19 May 93 amickish  Called add-component/interactor inside Call-Create-Inst
                      so that Create-Part and Create-Inter do not have to
                      add extra slot/value pairs to the slots list.
   7 Apr 93 amickish  Declared part-name constant in agget in Get-Part-From-Fn
  26 Mar 93 amickish  Removed EVAL from Call-Create-Instance for the last time!
  25 Mar 93 dzg  Added DECLARE-CONSTANT's in Get-Part-From-Function
  26 Feb 93 amickish  Rewrote Call-Create-Instance to use begin/end-create-
                      instance and not use copy-tree (ick).
   3 Jun 92 amickish  Wrote Get-Part-From-Function which allows a single part
                      to be generated by a function
  30 Apr 92 amickish  Bound kr::*redefine-ok* in Create-Part
  28 Apr 92 amickish  Wrapped destroy-slot calls in with-constants-disabled
   8 Apr 92 amickish  Made Call-Create-Instance non-destructive
   7 Apr 92 amickish  Wrapped calls to Call-Create-Instance in
                      with-constants-disabled.
  26 Mar 92 amickish  Get-Values--->G-Value; Get-Local-Values--->G-Local-Value
  16 Mar 92 amickish  Removed append-constant-slots -- obviated by KR.
  10 Mar 92 amickish  Fixed Call-Create-Instance to handle multiple-values
  03 Mar 92 amickish  Fixed Inherit-Values to use *inherit-formula*; broke
                      Get-Inherited-Value off from Inherit-Values
  28 Feb 92 amickish  Quoted class parameter in Call-Create-Instance
  24 Feb 92 amickish  Declared :components constant in :initialize method
  18 Feb 92 amickish  Implemented :constant slot functionality
  28 Jan 92 amickish  Rewrote create-part and create-inter to use
                  create-instance.  Changed name of first-obj-in-parts-list
                  to is-first-comp-in-parts-list.
  15 Apr 91 bam   Added the :behaviors slot to the :local-only-slots of
                  aggregadget
  16 Jul 90 rbd   Changed compilation order: aggregadgets first
   8 May 90 rbd   Major changes for new version.
   11/28/89 ecp   Fixed bug in create-part such that aggrelists were not
                  getting initialized correctly.
    9/28/89 ecp   Aggrelists can now have :interactors slots, too.
    9/18/89 ecp   Copy-parts should not have been calling itself recursively.
    9/14/89 ecp   The :initialize method for aggregadgets has optional
                  second argument to keep track of top level.
    8/2/89  prm   Optimized code after review meeting.
    7/20/89 prm   Removed aggregitems (now integrated to aggrelists).
    7/13/89 prm   Changed to work with aggrelists.
    7/6/89  prm   Changed syntax (class names must be comma-ed) to keep
                  everything consistent.
    6/28/89 prm   Changed to accept open formulas. This involved a change
                  of syntax (:parts and :interactors are now lists)
    6/28/89 prm   Changed the syntax: now :parts and :interactors are
                  lists instead of multi-value slots.
    6/28/89 prm   Fixed a bug: now sets :behaviors properly
    6/23/89 prm   Quoted the names in calls to create-instance, in order
                  to match KR 2.2
    6/8/89  prm   Added "element style" components (aggregitems)
    6/5/89  prm   Fixed a bug: now when copying a part that is an
                  aggregadget, create-prototype is called instead
                  of create-instance
    5/15/89 prm   Optimized the creation of instances of aggregadget
                  prototypes (makes copies of the prototype).
    5/11/89 prm   call-prototype-method moved to the beginning
                  of the :initialize method.
    4/18/89 prm   Changed again to match KR v2.0 (methods)
    4/07/89 prm   Changed to match KR v2.0
    3/28/89 prm   Added built-in interactors.
======================================================================
|#


;;;; aggregadgets-compiler.lisp
;;; Changes:
;;; 10/2/03 RGA --- New compile/load protocol
;;; 7/28/96 RGA --- changed to use garnet-compile/load
;;; 14-May-93 Mickish     Added new files, split off from others
;;; 20-Jan-92 Mickish     Removed make-package call
;;; 26-Mar-91 Pervin      Load compiled files in Lucid.
;;; 22-Mar-91 Pervin      Added setf of :garnet-modules, and provides at end.
;;; 19-Mar-91 Pervin      Added aggregraphs.
;;; 4-Mar-91 D'Souza      Removed nickname "MO" of Opal.
;;; 5-Jun-90 Richardson   Added lispworks
;;; 8-May-90 Dannenberg   Added new files
;;; 16-Apr-90 Pervin      Changed #+explorer to #+(or allegro explorer)
;;; 12-Apr-90 Mitchell    Added #+allegro (gc t)
;;; 3/22/90 Robert Cook - Define the package "OPAL" for the TI Explorer

;;;; save-agg.lisp
#|
======================================================================
Change log:
 9/01/93 amickish - Changed opal:text's :do-not-dump-slots for new design
 8/19/93 amickish - Added light motif colors and filling styles
 7/26/93 amickish - Moved defvar of *standard-element-slots* to copy-agg.lisp
           to avoid compiler warning
 7/02/93 amickish - Changed *standard-element-slots* for new aggrelists
 6/30/93 amickish - Made Write-Slots a method so that multifont-text can
           override its behavior
 6/23/93 bvz - Added slots to interactor's :do-not-dump-slots
 6/22/93 amickish - Removed :rank from *standard-element-slots*
 6/15/93 amickish - Changed :old-items to be a copy-but-don't-dump slot
 5/28/93 dzg - replaced called to obsolete kr::iterate-accessor with call to
	   kr::iterate-slot-value.
 5/24/93 amickish - Fixed output-name for interactors (bug introduced 11/9/92)
 5/20/93 amickish - Removed :internally-parented and :line-break-p references
 5/14/93 amickish - Removed references to *each-left/top-form*
 4/23/93 amickish - Added :old-items to *standard-element-slots*; added
           MOTIF-MENUBAR, MOTIF-RECT, MOTIF-TRILL-DEVICE, and POPUP-MENU-BUTTON
           to *standard-names*
 3/25/93 dzg - Fixed OUTPUT-META-IF-NEEDED to save initial value
 1/18/93 dzg - Added support for dumping formula meta-information.
 1/11/93 amickish - Removed :fast-redraw-p from :do-not-dump-slots
12/30/92 amickish - Write out calls to opal:get-standard-font when appropriate
12/15/92 dzg - Added printing of type declarations
11/09/92 amickish - Added printing of individual aggrelist components when
           :dump-children-as-parts is T.
07/14/92 dzg - Added printing of characters to output-value
07/08/92 amickish - Removed binding of 'state' in output-item-prototype;
           redesigned format procedures in Output-Formula; removed check
           of whether a component was an aggrelist element before deciding
           not to dump slots listed in *standard-element-slots* (now they
           are not dumped for all objects);
06/24/92 amickish - added formula-p checks to existing schema-p checks
05/01/92 bvz - added new stuff to interactors' :do-not-dump-slots list.
04/27/92 dzg - fixed output-formula to print formulas whose value is a list
               properly.
04/20/92 amickish - Added :gg-selected to :do-not-dump-slots of view-object
04/17/92 amickish - Added GARNETDRAW::MOVING-RECT, etc.
04/13/92 Pervin - Added :initial-element nil to all make-arrays.
04/10/92 Pervin - moved definitions of indent, outdent, tab earlier
                  to eliminate warnings, and declared *save-indent* in defvar.
04/07/91 amickish - Get-Local-Value ---> G-Local-Value
03/30/92 dzg - fixed to dump O-FORMULAS properly.
03/25/92 amickish - Get-Values ---> G-Value
03/10/92 Pervin - Write a filling-style as a call to opal:halftone when
           possible.
03/03/92 amickish - added another clause in Write-Slots cond to handle
           :constant lists that contain the :parent slot
03/03/92 amickish - fixed is-an-inherit-formula to be consistent with
           Inherit-Values in aggregadgets.lisp;  added progn in WRITE-SLOTS
           to set variables properly; added :internally-parented to
           :do-not-dump-slots list of opal:view-object
02/19/92 dzg - fixed write-gadget to work with KR 2.0.5.  Slots that used to
	   have a formula and became constant are dumped as values, but not
	   as constant values.
	   E-FORMULA is broken.  Is anybody using it???
01/08/92 Pervin - Really fixed bug I thought I fixed 07/09/91.
12/09/91 Amickish - Converted from multiple- to single-valued slots, and
           changed references to :is-a to break up the returned list.
11/27/91 Amickish - Changed the way that the garnet-gadgets package is created
11/26/91 Pervin - DO write out :image slot of bitmap if it's a formula.
08/30/91 Pervin/VanderZanden - Do not write out :image slot of bitmap.
07/09/91 Edward Pervin - Print out one more ")" when printing :interactors
	   of aggregadget.
04/08/91 Andrew Mickish - Added opal:cursor-text to list of known objects;
           Removed :window, added :final-feed-inuse, :final-feed-avail, and
           :generated-running-where to :do-not-dump-slots of inter:interactor.
03/11/91 Dario Giuse - Changed Output-Formula to fix problem saving bitmaps
11/04/90 Dannenberg :do-not-dump-objects can be used to suppress writing
           children graphic-qualities are now written out using create-instance
======================================================================
|#
